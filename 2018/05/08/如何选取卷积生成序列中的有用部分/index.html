<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>如何选取卷积生成序列中的有用部分 | Renewing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="卷积原理在信号与系统中，卷积积分是线性时不变系统分析的一个重要工具，具体是通过两个函数f和g生成第三个函数，表征函数f与g经过翻转和平移的重叠部分的面积。 卷积是两个变量在某范围内相乘后求和的结果。如果卷积的变量是序列x(n)和h(n)，则卷积的结果y(n)=x(n)h(n)，其中星号表示卷积。当时序n=0时，序列h(-i)是h(i)的时序i取反的结果；时序取反使得h(i)以纵轴为中心翻转180度">
<meta name="keywords" content="信号处理,卷积序列">
<meta property="og:type" content="article">
<meta property="og:title" content="如何选取卷积生成序列中的有用部分">
<meta property="og:url" content="http://www.wuxiaochun.cn/2018/05/08/如何选取卷积生成序列中的有用部分/index.html">
<meta property="og:site_name" content="Renewing">
<meta property="og:description" content="卷积原理在信号与系统中，卷积积分是线性时不变系统分析的一个重要工具，具体是通过两个函数f和g生成第三个函数，表征函数f与g经过翻转和平移的重叠部分的面积。 卷积是两个变量在某范围内相乘后求和的结果。如果卷积的变量是序列x(n)和h(n)，则卷积的结果y(n)=x(n)h(n)，其中星号表示卷积。当时序n=0时，序列h(-i)是h(i)的时序i取反的结果；时序取反使得h(i)以纵轴为中心翻转180度">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-06-05T08:40:11.276Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="如何选取卷积生成序列中的有用部分">
<meta name="twitter:description" content="卷积原理在信号与系统中，卷积积分是线性时不变系统分析的一个重要工具，具体是通过两个函数f和g生成第三个函数，表征函数f与g经过翻转和平移的重叠部分的面积。 卷积是两个变量在某范围内相乘后求和的结果。如果卷积的变量是序列x(n)和h(n)，则卷积的结果y(n)=x(n)h(n)，其中星号表示卷积。当时序n=0时，序列h(-i)是h(i)的时序i取反的结果；时序取反使得h(i)以纵轴为中心翻转180度">
  
    <link rel="alternative" href="/atom.xml" title="Renewing" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">

</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/img/youyou.jpg" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Renewing</a></h1>
		</hgroup>

		
		<p class="header-subtitle">此心安处，便是吾乡。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/archives">文章归档</a></li>
				        
							<li><a href="/categories/machine-learning">机器学习</a></li>
				        
							<li><a href="/categories/deep-learning">深度学习</a></li>
				        
							<li><a href="/categories/signal-processing">信号处理</a></li>
				        
							<li><a href="/categories/mind-palace">随笔</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Renewing" title="github">github</a>
					        
								<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/zs-renewing/activities" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="mailto:wxc19966@pku.edu.cn" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/TensorFlow/" style="font-size: 10px;">TensorFlow</a> <a href="/tags/信号处理/" style="font-size: 10px;">信号处理</a> <a href="/tags/卷积序列/" style="font-size: 10px;">卷积序列</a> <a href="/tags/机器学习/" style="font-size: 20px;">机器学习</a> <a href="/tags/树模型/" style="font-size: 10px;">树模型</a> <a href="/tags/深度学习/" style="font-size: 20px;">深度学习</a> <a href="/tags/特征处理/" style="font-size: 10px;">特征处理</a> <a href="/tags/特征工程/" style="font-size: 10px;">特征工程</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">微电子码农，PKU在读，机器学习菜鸟。此博客日常分享技术心得，抽风吐槽心情。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Renewing</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img src="/img/youyou.jpg" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Renewing</h1>
			</hgroup>
			
			<p class="header-subtitle">此心安处，便是吾乡。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/archives">文章归档</a></li>
		        
					<li><a href="/categories/machine-learning">机器学习</a></li>
		        
					<li><a href="/categories/deep-learning">深度学习</a></li>
		        
					<li><a href="/categories/signal-processing">信号处理</a></li>
		        
					<li><a href="/categories/mind-palace">随笔</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Renewing" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/zs-renewing/activities" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="mailto:wxc19966@pku.edu.cn" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-如何选取卷积生成序列中的有用部分" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/05/08/如何选取卷积生成序列中的有用部分/" class="article-date">
  	<time datetime="2018-05-07T16:03:18.000Z" itemprop="datePublished">2018-05-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      如何选取卷积生成序列中的有用部分
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/信号处理/">信号处理</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/卷积序列/">卷积序列</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/signal-processing/">信号处理</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="卷积原理"><a href="#卷积原理" class="headerlink" title="卷积原理"></a>卷积原理</h1><p>在信号与系统中，卷积积分是线性时不变系统分析的一个重要工具，具体是通过两个函数f和g生成第三个函数，表征函数f与g经过翻转和平移的重叠部分的面积。</p>
<p>卷积是两个变量在某范围内相乘后求和的结果。如果卷积的变量是序列x(n)和h(n)，则卷积的结果y(n)=x(n)<em>h(n)，其中星号</em>表示卷积。当时序n=0时，序列h(-i)是h(i)的时序i取反的结果；时序取反使得h(i)以纵轴为中心翻转180度，所以这种相乘后求和的计算法称为卷积和，简称卷积。另外，n是使h(-i)位移的量，不同的n对应不同的卷积结果。</p>
<p>如果卷积的变量是函数x(t)和h(t)，则卷积的计算变为y(t)=x(t)<em>h(t)，其中p是积分变量，积分也是求和，t是使函数h(-p)位移的量，星号</em>表示卷积。</p>
<p>已知信号长度为M的时间序列{x(i), i=1,M}与长度为N的近似理想脉冲响应滤波器{h(i),i=1,N}的卷积长度为M+N-1的序列{y(i),i=1,M+N-1}。实际上只有中间的M-N+1的长度是有效卷积的内容。而两端各有N/2的长度,是部分{h(i)}和{x(i)}乘积求和的结果，是两个脉冲函数，这两端的部分不是我们想要的。</p>
<p>在实际应用中，我们希望得到的{y(i)}，不仅能够在长度上与{x(i)}一致，而且在内容上也全部是有效的。MATLAB中conv(x,h,flag)的函数flag有三个选项“full”,”same”和“valid”。在默认情况下是“full”全部长度即M+N-1,完整的调用格式为conv(x,h,’full’)。 ‘valid’选项的长度只M-N+1, 其内容就是’same’和‘full’的中间M-N+1的部分。而‘same’中的前首尾两端各N/2不是我们想要的，’full’首尾两端各N的长度也不是我们想要的。<br><a id="more"></a></p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><h2 id="1-周期延拓"><a href="#1-周期延拓" class="headerlink" title="1.周期延拓"></a>1.周期延拓</h2><p>将原始的{x(i)}中尾部N/2长度的数据接在其前面，并且将原始{x(i)}中头部的数据接在其后面，即完成了周期延拓。再使用conv(x, h, ‘valid’)就可以得到与原始{x(i)}在长度上相同，重要的是有效地卷积序列。</p>
<h2 id="2-多条数据首尾相接法"><a href="#2-多条数据首尾相接法" class="headerlink" title="2.多条数据首尾相接法"></a>2.多条数据首尾相接法</h2><p>如果{x(i)}是一条数据的长度，那么可将前条数据末尾的N/2长度接在当条数据的前面，将下一条数据头部的N/2长度接在当条的尾部，再进行conv(x, h, ‘valid’)就可以得到与原始{x(i)}在长度上相同，重要的是有效地卷积序列。<br>两种方法的差别在于有效部分开始的少量结果有一致，到中间有效部分的长度就是完全一样的了。</p>
<h2 id="matlab实现代码"><a href="#matlab实现代码" class="headerlink" title="matlab实现代码"></a>matlab实现代码</h2><p><code>`</code>matlab</p>
<pre><code>h=load(&apos;hfilter.dat&apos;); 
N=length(h);  
d1=load(&apos;MZL3_20080101Hx.dat&apos;); 
d2=load(&apos;MZL3_20080102Hx.dat&apos;); 
d3=load(&apos;MZL3_20080103Hx.dat&apos;); 
M=length(d1);    

Figure   
% 用当条的数据周期延拓  
dd1=[d2(M-N/2+1:end); d2; d2(1:N/2)]; 
% 使用三条的数据接起来  
dd2=[d1(M-N/2+1:end); d2; d3(1:N/2)]; 
plot(dd1,&apos;r&apos;);hold on; 
plot(dd2);   

figure  
y1=conv(dd1,h,&apos;valid&apos;); 
y2=conv(dd2,h,&apos;valid&apos;);  
plot(y1(1:N/2),&apos;ro&apos;);hold on; 
plot(y2(1:N/2),&apos;*&apos;);    

figure   
y11=conv(dd1,h,&apos;same&apos;); 
y22=conv(dd2,h,&apos;same&apos;); 
plot(y11,&apos;ro&apos;);hold on; 
plot(y22,&apos;*&apos;); 

figure  
y111=conv(d2,h,&apos;same&apos;);  
yy111=[zeros(N/2,1); y111;zeros(N/2,1)]; 
y222=conv(d3,h,&apos;full&apos;); 
plot(yy111 ,&apos;r&apos;);hold on; 
plot(y222);
</code></pre><h2 id="C语言实现"><a href="#C语言实现" class="headerlink" title="C语言实现"></a>C语言实现</h2><p>在用c语言来实现带通滤波器时我们遇到了这个问题，最终使用的是只计算两个序列对齐时的卷积值当作总的卷积值，代码如下：</p>
<p><code>`</code>c</p>
<pre><code>int coefficient_bp[length_bp] =
{
165, 115, 121, 101, 56, -6, -71, -129, -173, -204, -231, -268, -321, -393, -467,
-517, -510, -417, -226, 54, 386, 715, 981, 1129, 1129, 981, 715, 386, 54, -226,
-417, -510, -517, -467, -393, -321, -268, -231, -204, -173, -129, -71, -6, 56,
101, 121, 115, 165
};

int data_before_filter_array[length_bp];
int num_fir_bp=0;

int get_num_fir_bp()
{
    return num_fir_bp;
}
</code></pre><p>//<strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong>带通滤波函数<strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></p>
<pre><code>int fir_bp(int data_before_filter)
{
    int data_filtered_bp = 0;
    if (num_fir_bp &lt; length_bp)      //输入数据数组未填满时，不计算结果
    {
        data_before_filter_array[num_fir_bp] = data_before_filter;
        num_fir_bp++;
        if (num_fir_bp == length_bp)  //输入数据数组刚好填满时，计算第一个结果
        {
            for (int i = 0; i &lt; length_bp; i++)
            {
                data_filtered_bp = data_filtered_bp + coefficient_bp[i] * data_before_filter_array[i];
            }
            data_filtered_bp=data_filtered_bp&gt;&gt;13;  //恢复原来的大小

            // chenhao0620 限幅
            data_filtered_bp = data_filtered_bp&gt;32767 ? 32767:(data_filtered_bp&lt;-32768?-32767:data_filtered_bp);
            return data_filtered_bp;
        }
        return 0;
    }
    else
    {
        for (int i = 1; i &lt; length_bp; i++) //输入数据数组填满之后更新与移动
        {
            data_before_filter_array[i - 1] = data_before_filter_array[i];
        }     //原代码有bug，提前将新数据灌进去了，导致46和47(最后两个)是一样的
        data_before_filter_array[length_bp-1] = data_before_filter;

        for (int i = 0; i &lt; length_bp; i++) //卷积计算
        {
            data_filtered_bp = data_filtered_bp + coefficient_bp[i] * data_before_filter_array[i];
        }
        data_filtered_bp=data_filtered_bp&gt;&gt;13;  //因为滤波器函数为了取整扩大了2^13倍，现在移位来恢复原来的大小

    //限幅
        data_filtered_bp = data_filtered_bp&gt;32767 ? 32767:(data_filtered_bp&lt;-32768?-32767:data_filtered_bp);
        return data_filtered_bp;
    }
}
</code></pre>
      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/05/20/数据分箱/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          数据分箱
        
      </div>
    </a>
  
  
    <a href="/2018/05/05/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Hello bear.</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>








</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 Renewing
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
<span id="busuanzi_container_page_pv">
  本文总阅读量<span id="busuanzi_value_page_pv"></span>次
</span>
</footer>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: ,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>